# Deep Analysis: Singapore SMB Customer Enquiry Support AI Agent

---

## Executive Summary

I have conducted an exhaustive multi-dimensional analysis of your requirements. This document presents a **comprehensive architectural design** and **detailed implementation plan** for a production-ready AI customer support agent tailored to Singapore SMB contexts.

Before proceeding to implementation, I present this design for your **validation and approval**.

---

## Phase 1: Deep Requirement Analysis

### 1.1 Multi-Dimensional Context Analysis

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        SINGAPORE SMB CONTEXT MAPPING                            │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  BUSINESS REALITY                    TECHNICAL CONSTRAINTS                      │
│  ─────────────────                   ──────────────────────                     │
│  • 5-50 employees typical            • Limited IT budget                        │
│  • Multi-ethnic customer base        • Shared hosting/cloud                     │
│  • High service expectations         • Single DevOps resource                   │
│  • Competitive market pressure       • Cost-per-query sensitivity              │
│                                                                                 │
│  CULTURAL NUANCES                    REGULATORY REQUIREMENTS                    │
│  ────────────────────                ───────────────────────                    │
│  • Singlish code-switching           • PDPA compliance mandatory               │
│  • Direct but polite tone            • Data residency (SG preferred)           │
│  • Face-saving in complaints         • Consent management                       │
│  • Multi-generational users          • Right to erasure support                │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.2 User Journey Psychological Analysis

| User Segment | Cognitive State | Expectation | Design Implication |
|--------------|-----------------|-------------|-------------------|
| **Frustrated Customer** | High cognitive load, emotional | Immediate acknowledgment, fast resolution | Empathy-first responses, rapid escalation path |
| **Information Seeker** | Goal-oriented, impatient | Precise answers, no fluff | Structured responses, source citations |
| **Comparison Shopper** | Analytical, skeptical | Detailed specs, honest limitations | Factual grounding, RAG-backed claims |
| **Returning Customer** | Familiar, expects recognition | Personalized context | Long-term memory recall |
| **Non-Native English** | Uncertain, may code-switch | Language flexibility | Multi-lingual detection, Singlish tolerance |

### 1.3 Enquiry Classification Taxonomy

Based on typical Singapore SMB patterns:

```
CUSTOMER_ENQUIRY_TAXONOMY
├── TRANSACTIONAL (40%)
│   ├── Order Status
│   ├── Booking/Appointment
│   ├── Payment Issues
│   └── Returns/Refunds
├── INFORMATIONAL (35%)
│   ├── Product/Service Details
│   ├── Pricing Enquiries
│   ├── Operating Hours/Location
│   └── Policies (Warranty, Delivery)
├── RELATIONAL (15%)
│   ├── Complaints/Feedback
│   ├── General Support
│   └── Partnership Enquiries
└── ADMINISTRATIVE (10%)
    ├── Account Management
    ├── Contact Updates
    └── Data Requests (PDPA)
```

---

## Phase 2: System Architecture Design

### 2.1 High-Level Architecture

```
┌────────────────────────────────────────────────────────────────────────────────────────┐
│                              SYSTEM ARCHITECTURE OVERVIEW                              │
└────────────────────────────────────────────────────────────────────────────────────────┘

     ┌──────────────────┐
     │   REACT FRONTEND │
     │   (Chat Widget)  │
     └────────┬─────────┘
              │ WebSocket/SSE
              ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                   API GATEWAY                                        │
│  ┌─────────────┐  ┌──────────────┐  ┌───────────────┐  ┌──────────────────────────┐ │
│  │ Rate Limiter│  │ Auth/Session │  │ Request Router│  │ Response Streaming       │ │
│  └─────────────┘  └──────────────┘  └───────────────┘  └──────────────────────────┘ │
└────────────────────────────────────────┬────────────────────────────────────────────┘
                                         │
              ┌──────────────────────────┴───────────────────────────┐
              │                                                      │
              ▼                                                      ▼
┌──────────────────────────────┐                    ┌──────────────────────────────────┐
│      AGENT ORCHESTRATOR      │                    │        KNOWLEDGE SERVICE         │
│         (LangGraph)          │                    │                                  │
│  ┌────────────────────────┐  │                    │  ┌────────────────────────────┐  │
│  │   State Machine        │  │◄──────────────────►│  │   RAG Pipeline             │  │
│  │   ┌──────────────────┐ │  │                    │  │   • Query Transformation   │  │
│  │   │ Intent Classifier│ │  │                    │  │   • Hybrid Search          │  │
│  │   ├──────────────────┤ │  │                    │  │   • Cross-Encoder Rerank   │  │
│  │   │ Tool Executor    │ │  │                    │  │   • Context Compression    │  │
│  │   ├──────────────────┤ │  │                    │  └────────────────────────────┘  │
│  │   │ Response Gen     │ │  │                    │                                  │
│  │   ├──────────────────┤ │  │                    │  ┌────────────────────────────┐  │
│  │   │ Validation       │ │  │                    │  │   Vector Store (Qdrant)    │  │
│  │   └──────────────────┘ │  │                    │  │   • Business Documents     │  │
│  └────────────────────────┘  │                    │  │   • FAQ Embeddings         │  │
│                              │                    │  │   • Conversation Memories  │  │
│  ┌────────────────────────┐  │                    │  └────────────────────────────┘  │
│  │   Pydantic Schemas     │  │                    │                                  │
│  │   • Input Validation   │  │                    └──────────────────────────────────┘
│  │   • Output Validation  │  │
│  │   • State Management   │  │
│  └────────────────────────┘  │
└───────────────┬──────────────┘
                │
     ┌──────────┴──────────┐
     ▼                     ▼
┌──────────────┐    ┌──────────────────────────────────────────────────────────────────┐
│    TOOLS     │    │                      MEMORY SUBSYSTEM                            │
│              │    │  ┌─────────────────────────────────────────────────────────────┐ │
│ • KB Search  │    │  │  SHORT-TERM MEMORY (Redis)                                  │ │
│ • Product DB │    │  │  • Active session buffer                                    │ │
│ • Booking    │    │  │  • Rolling conversation window (last 10 turns)              │ │
│ • Escalation │    │  │  • Current intent & entities                                │ │
│ • Pricing    │    │  └─────────────────────────────────────────────────────────────┘ │
│ • Hours      │    │                                                                  │
└──────────────┘    │  ┌─────────────────────────────────────────────────────────────┐ │
                    │  │  LONG-TERM MEMORY (PostgreSQL + Qdrant)                     │ │
                    │  │  • Customer profiles & preferences                          │ │
                    │  │  • Conversation summaries (embedded)                        │ │
                    │  │  • Interaction history                                      │ │
                    │  │  • Feedback & sentiment trends                              │ │
                    │  └─────────────────────────────────────────────────────────────┘ │
                    └──────────────────────────────────────────────────────────────────┘
```

### 2.2 Agent State Machine (LangGraph)

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                            LANGGRAPH AGENT STATE MACHINE                            │
└─────────────────────────────────────────────────────────────────────────────────────┘

                                    ┌─────────────┐
                                    │   START     │
                                    └──────┬──────┘
                                           │
                                           ▼
                              ┌────────────────────────┐
                              │   RECEIVE_MESSAGE      │
                              │   • Parse input        │
                              │   • Language detect    │
                              │   • Load memory        │
                              └───────────┬────────────┘
                                          │
                                          ▼
                              ┌────────────────────────┐
                              │   CLASSIFY_INTENT      │
                              │   • Extract entities   │
                              │   • Route decision     │
                              └───────────┬────────────┘
                                          │
                    ┌─────────────────────┼─────────────────────┐
                    │                     │                     │
                    ▼                     ▼                     ▼
          ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐
          │  SIMPLE_QUERY   │   │  COMPLEX_QUERY  │   │   ESCALATION    │
          │  • Direct RAG   │   │  • Decompose    │   │  • Human handoff│
          │  • Single tool  │   │  • Multi-step   │   │  • Create ticket│
          └────────┬────────┘   └────────┬────────┘   └────────┬────────┘
                   │                     │                     │
                   │            ┌────────┴────────┐            │
                   │            ▼                 │            │
                   │   ┌─────────────────┐        │            │
                   │   │  RETRIEVE       │◄───────┤            │
                   │   │  • Hybrid search│        │            │
                   │   │  • Rerank       │        │            │
                   │   └────────┬────────┘        │            │
                   │            │                 │            │
                   │            ▼                 │            │
                   │   ┌─────────────────┐        │            │
                   │   │  REASON         │        │            │
                   │   │  • Evaluate     │────────┘            │
                   │   │  • Need more?   │  (loop if needed)   │
                   │   └────────┬────────┘                     │
                   │            │                              │
                   └────────────┼──────────────────────────────┘
                                │
                                ▼
                    ┌────────────────────────┐
                    │   GENERATE_RESPONSE    │
                    │   • Compose answer     │
                    │   • Apply tone/lang    │
                    │   • Add citations      │
                    └───────────┬────────────┘
                                │
                                ▼
                    ┌────────────────────────┐
                    │   VALIDATE_OUTPUT      │
                    │   • Hallucination chk  │
                    │   • PDPA compliance    │
                    │   • Confidence score   │
                    └───────────┬────────────┘
                                │
                                ▼
                    ┌────────────────────────┐
                    │   UPDATE_MEMORY        │
                    │   • Short-term buffer  │
                    │   • Long-term if sig   │
                    │   • Summarize if full  │
                    └───────────┬────────────┘
                                │
                                ▼
                         ┌─────────────┐
                         │   RESPOND   │
                         └─────────────┘
```

### 2.3 Data Schema Design (Pydantic Models)

```python
# Core Domain Models

from pydantic import BaseModel, Field, field_validator
from typing import Optional, List, Dict, Any, Literal
from datetime import datetime
from enum import Enum

class Language(str, Enum):
    ENGLISH = "en"
    MANDARIN = "zh"
    MALAY = "ms"
    TAMIL = "ta"
    SINGLISH = "en-SG"

class IntentCategory(str, Enum):
    PRODUCT_INQUIRY = "product_inquiry"
    PRICING = "pricing"
    ORDER_STATUS = "order_status"
    BOOKING = "booking"
    COMPLAINT = "complaint"
    RETURNS = "returns"
    OPERATING_HOURS = "operating_hours"
    GENERAL_FAQ = "general_faq"
    ESCALATION = "escalation"
    GREETING = "greeting"
    UNKNOWN = "unknown"

class CustomerProfile(BaseModel):
    """Long-term customer memory structure"""
    customer_id: str = Field(..., description="Unique customer identifier")
    name: Optional[str] = None
    email: Optional[str] = None
    phone: Optional[str] = None
    preferred_language: Language = Language.ENGLISH
    timezone: str = "Asia/Singapore"
    first_interaction: datetime
    total_interactions: int = 0
    sentiment_trend: float = Field(default=0.0, ge=-1.0, le=1.0)
    preferences: Dict[str, Any] = Field(default_factory=dict)
    past_issues_summary: Optional[str] = None
    tags: List[str] = Field(default_factory=list)
    pdpa_consent: bool = False
    consent_timestamp: Optional[datetime] = None

class ConversationMessage(BaseModel):
    """Single message in conversation"""
    id: str
    role: Literal["user", "assistant", "system"]
    content: str
    timestamp: datetime
    language_detected: Optional[Language] = None
    intent: Optional[IntentCategory] = None
    entities: Dict[str, Any] = Field(default_factory=dict)
    confidence: Optional[float] = None
    sources_used: List[str] = Field(default_factory=list)
    
class RetrievedContext(BaseModel):
    """Document retrieved from knowledge base"""
    chunk_id: str
    content: str
    source_document: str
    relevance_score: float
    metadata: Dict[str, Any] = Field(default_factory=dict)
    
class ConversationState(BaseModel):
    """Complete state for LangGraph agent"""
    session_id: str
    customer: CustomerProfile
    messages: List[ConversationMessage] = Field(default_factory=list)
    current_intent: Optional[IntentCategory] = None
    detected_language: Language = Language.ENGLISH
    entities: Dict[str, Any] = Field(default_factory=dict)
    retrieved_contexts: List[RetrievedContext] = Field(default_factory=list)
    tool_calls_made: List[str] = Field(default_factory=list)
    requires_escalation: bool = False
    escalation_reason: Optional[str] = None
    conversation_summary: Optional[str] = None
    turn_count: int = 0
    
    @field_validator('messages')
    @classmethod
    def limit_message_buffer(cls, v):
        """Keep only last 20 messages to manage context window"""
        return v[-20:] if len(v) > 20 else v

class AgentResponse(BaseModel):
    """Validated agent output"""
    content: str
    language: Language
    intent_handled: IntentCategory
    confidence_score: float = Field(..., ge=0.0, le=1.0)
    sources: List[str] = Field(default_factory=list)
    suggested_actions: List[str] = Field(default_factory=list)
    requires_followup: bool = False
    escalated: bool = False
    metadata: Dict[str, Any] = Field(default_factory=dict)
```

### 2.4 RAG Pipeline Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              RAG PIPELINE ARCHITECTURE                              │
└─────────────────────────────────────────────────────────────────────────────────────┘

OFFLINE INDEXING PIPELINE
═══════════════════════════

┌────────────────┐    ┌─────────────────┐    ┌──────────────────┐    ┌─────────────┐
│ Document Store │───►│ Document Loader │───►│ Content Extractor│───►│   Cleaner   │
│                │    │ (Unstructured)  │    │ (Text + Tables)  │    │ (Noise rem) │
│ • PDFs         │    │                 │    │                  │    │             │
│ • Word docs    │    │ Handles:        │    │ Extracts:        │    │ Removes:    │
│ • Web pages    │    │ • 65+ formats   │    │ • Main text      │    │ • Headers   │
│ • FAQ sheets   │    │ • OCR support   │    │ • Table data     │    │ • Footers   │
│ • Product CSV  │    │ • Layout aware  │    │ • Image captions │    │ • Nav menus │
└────────────────┘    └─────────────────┘    └──────────────────┘    └──────┬──────┘
                                                                            │
              ┌─────────────────────────────────────────────────────────────┘
              │
              ▼
┌──────────────────────┐    ┌───────────────────┐    ┌─────────────────────────────┐
│  Semantic Chunker    │───►│ Metadata Enricher │───►│ Embedding Generator         │
│                      │    │                   │    │                             │
│ Strategy:            │    │ Auto-generates:   │    │ Model: text-embedding-3-small│
│ • Semantic breakpts  │    │ • doc_type        │    │ Dimension: 1536             │
│ • 512 token target   │    │ • category        │    │ Batch processing            │
│ • 50 token overlap   │    │ • language        │    │                             │
│ • Preserve Q&A pairs │    │ • last_updated    │    │                             │
│                      │    │ • summary         │    │                             │
└──────────────────────┘    └───────────────────┘    └─────────────┬───────────────┘
                                                                    │
                                                                    ▼
                                                    ┌───────────────────────────────┐
                                                    │       QDRANT VECTOR DB        │
                                                    │                               │
                                                    │ Collections:                  │
                                                    │ • knowledge_base (main docs)  │
                                                    │ • faqs (Q&A optimized)        │
                                                    │ • conversation_memory         │
                                                    │                               │
                                                    │ Indexes:                      │
                                                    │ • HNSW (ef=128, m=16)         │
                                                    │ • Payload filtering enabled   │
                                                    └───────────────────────────────┘


ONLINE RETRIEVAL PIPELINE
═══════════════════════════

┌──────────────┐
│ User Query   │
└──────┬───────┘
       │
       ▼
┌──────────────────────────────────────────────────────────────────┐
│                    QUERY TRANSFORMATION                          │
│  ┌────────────────┐  ┌────────────────┐  ┌────────────────────┐  │
│  │ Query Rewrite  │  │ HyDE Generator │  │ Sub-Q Decomposer   │  │
│  │ (clarity)      │  │ (hypothetical) │  │ (complex queries)  │  │
│  └────────────────┘  └────────────────┘  └────────────────────┘  │
└──────────────────────────────────┬───────────────────────────────┘
                                   │
                                   ▼
┌──────────────────────────────────────────────────────────────────┐
│                      HYBRID RETRIEVAL                            │
│                                                                  │
│   ┌─────────────────────┐         ┌─────────────────────┐        │
│   │   SPARSE (BM25)     │         │   DENSE (Vector)    │        │
│   │   • Keyword match   │         │   • Semantic match  │        │
│   │   • Exact terms     │         │   • Conceptual sim  │        │
│   │   k=30              │         │   k=30              │        │
│   └──────────┬──────────┘         └──────────┬──────────┘        │
│              │                               │                   │
│              └──────────────┬────────────────┘                   │
│                             ▼                                    │
│              ┌──────────────────────────┐                        │
│              │   RECIPROCAL RANK FUSION │                        │
│              │   • Combine rankings     │                        │
│              │   • k=60 constant        │                        │
│              │   • Output: top 20       │                        │
│              └──────────────────────────┘                        │
└──────────────────────────────────────┬───────────────────────────┘
                                       │
                                       ▼
┌──────────────────────────────────────────────────────────────────┐
│                    CROSS-ENCODER RERANKING                       │
│                                                                  │
│   Model: cross-encoder/ms-marco-MiniLM-L-12-v2                   │
│   Input: Query + Top 20 candidates                               │
│   Output: Top 5 most relevant, reordered by score                │
│                                                                  │
└──────────────────────────────────────┬───────────────────────────┘
                                       │
                                       ▼
┌──────────────────────────────────────────────────────────────────┐
│                   CONTEXT COMPRESSION                            │
│                                                                  │
│   • LLMLingua or extractive compression                          │
│   • Reduce token count by ~40%                                   │
│   • Preserve key information density                             │
│   • Fit within 4K token budget for context                       │
│                                                                  │
└──────────────────────────────────────┬───────────────────────────┘
                                       │
                                       ▼
                            ┌──────────────────┐
                            │ FINAL CONTEXT    │
                            │ Ready for LLM    │
                            └──────────────────┘
```

### 2.5 Memory Architecture Deep Dive

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                           HIERARCHICAL MEMORY SYSTEM                                │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│ LAYER 1: WORKING MEMORY (Immediate Context)                                         │
│ ───────────────────────────────────────────                                         │
│ Storage: In-process / LangGraph State                                               │
│ Lifetime: Single LLM call                                                           │
│                                                                                     │
│ Contents:                                                                           │
│ ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│ │  System Prompt (~500 tokens)                                                    │ │
│ │  ├── Business identity & persona                                                │ │
│ │  ├── Response guidelines                                                        │ │
│ │  └── Tool descriptions                                                          │ │
│ │                                                                                 │ │
│ │  Retrieved Context (~2000 tokens)                                               │ │
│ │  ├── Top 5 reranked chunks                                                      │ │
│ │  └── Source citations                                                           │ │
│ │                                                                                 │ │
│ │  Conversation Window (~1000 tokens)                                             │ │
│ │  ├── Last 4-6 turns                                                             │ │
│ │  └── Current query                                                              │ │
│ │                                                                                 │ │
│ │  Customer Context (~300 tokens)                                                 │ │
│ │  ├── Name, preferences                                                          │ │
│ │  └── Relevant past interaction summary                                          │ │
│ └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                     │
│ Total Budget: ~4000 tokens (leaves room for generation)                             │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│ LAYER 2: SHORT-TERM MEMORY (Session Buffer)                                         │
│ ───────────────────────────────────────────                                         │
│ Storage: Redis (with TTL)                                                           │
│ Lifetime: Session duration + 24 hours                                               │
│                                                                                     │
│ Structure:                                                                          │
│ ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│ │  session:{session_id}                                                           │ │
│ │  ├── messages: List[ConversationMessage]  (full history, max 50)                │ │
│ │  ├── current_intent: IntentCategory                                             │ │
│ │  ├── entities: Dict (extracted entities this session)                           │ │
│ │  ├── tool_calls: List (tools used this session)                                 │ │
│ │  └── rolling_summary: str (compressed older messages)                           │ │
│ └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                     │
│ Summarization Trigger: When messages > 15, summarize oldest 10 → rolling_summary    │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│ LAYER 3: LONG-TERM MEMORY (Persistent Knowledge)                                    │
│ ────────────────────────────────────────────────                                    │
│ Storage: PostgreSQL + Qdrant                                                        │
│ Lifetime: Indefinite (with PDPA retention policies)                                 │
│                                                                                     │
│ PostgreSQL Tables:                                                                  │
│ ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│ │  customers                                                                      │ │
│ │  ├── id, name, email, phone, preferences                                        │ │
│ │  ├── pdpa_consent, consent_timestamp                                            │ │
│ │  ├── created_at, updated_at                                                     │ │
│ │  └── sentiment_score (rolling average)                                          │ │
│ │                                                                                 │ │
│ │  conversations                                                                  │ │
│ │  ├── id, customer_id, session_id                                                │ │
│ │  ├── started_at, ended_at                                                       │ │
│ │  ├── summary (LLM-generated)                                                    │ │
│ │  ├── intent_categories (array)                                                  │ │
│ │  └── resolution_status                                                          │ │
│ │                                                                                 │ │
│ │  interaction_events                                                             │ │
│ │  ├── id, conversation_id, event_type                                            │ │
│ │  ├── details (JSONB)                                                            │ │
│ │  └── timestamp                                                                  │ │
│ └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                     │
│ Qdrant Collection: conversation_memory                                              │
│ ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│ │  Stores: Embedded conversation summaries                                        │ │
│ │  Enables: Semantic search over past interactions                                │ │
│ │  Use case: "Customer asked similar question 2 months ago about X"               │ │
│ │  Payload: customer_id, timestamp, summary, intent, resolution                   │ │
│ └─────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘

MEMORY FLOW DURING CONVERSATION
════════════════════════════════

   New Message Arrives
          │
          ▼
   ┌──────────────────┐
   │ Load from Redis  │──── Session exists? ────┐
   │ (short-term)     │                         │
   └────────┬─────────┘                         │ No
            │ Yes                               ▼
            │                        ┌────────────────────┐
            │                        │ Create new session │
            │                        │ Load customer from │
            │                        │ PostgreSQL if known│
            │                        └─────────┬──────────┘
            │                                  │
            └─────────────┬────────────────────┘
                          │
                          ▼
               ┌────────────────────┐
               │ Need past context? │
               │ (complex query or  │
               │  returning customer)│
               └─────────┬──────────┘
                         │ Yes
                         ▼
               ┌────────────────────┐
               │ Semantic search    │
               │ conversation_memory│
               │ in Qdrant          │
               └─────────┬──────────┘
                         │
                         ▼
               ┌────────────────────┐
               │ Assemble Working   │
               │ Memory for LLM     │
               └─────────┬──────────┘
                         │
                         ▼
               [Agent Processing...]
                         │
                         ▼
               ┌────────────────────┐
               │ Update short-term  │
               │ memory in Redis    │
               └─────────┬──────────┘
                         │
                         ▼
               ┌────────────────────┐
               │ Session ending?    │─── No ──► Done
               └─────────┬──────────┘
                         │ Yes
                         ▼
               ┌────────────────────┐
               │ Generate summary   │
               │ Store in PostgreSQL│
               │ Embed in Qdrant    │
               │ Update customer    │
               └────────────────────┘
```

---

## Phase 3: Technology Stack Justification

### 3.1 Stack Selection Matrix

| Component | Selection | Justification | Alternatives Considered |
|-----------|-----------|---------------|------------------------|
| **Frontend** | React 18 + TypeScript | Type safety, hooks for state, streaming support | Vue 3 (less ecosystem), Svelte (newer) |
| **UI Library** | Shadcn/UI + Tailwind | Accessible primitives, customizable, lightweight | MUI (heavy), Chakra (opinionated) |
| **API Framework** | FastAPI (Python) | Async native, Pydantic integration, WebSocket support | Flask (sync), Django (overkill) |
| **Agent Framework** | LangChain 1.0 + LangGraph | Stateful agents, tool abstraction, LCEL | LlamaIndex (more RAG-focused), Haystack |
| **Validation** | Pydantic v2 | Performance, LangChain integration, clear schemas | Marshmallow (slower), dataclasses |
| **Vector Store** | Qdrant | Rust performance, filtering, hybrid search, self-hosted | Chroma (simpler), Milvus (complex), Pinecone (SaaS cost) |
| **Embedding Model** | OpenAI text-embedding-3-small | Cost-effective, good performance, 1536 dims | Cohere (similar), local models (infra) |
| **LLM** | GPT-4o-mini (primary), GPT-4o (complex) | Cost/quality balance for SMB | Claude (similar), local (latency) |
| **Reranker** | cross-encoder/ms-marco-MiniLM-L-12-v2 | Open-source, fast, accurate | Cohere Rerank (cost), BGE (similar) |
| **Cache/Session** | Redis | Fast, TTL support, pub/sub for scaling | Memcached (less features) |
| **Database** | PostgreSQL 16 | JSONB, full-text search, reliability | MySQL (less features), MongoDB (not relational) |
| **Document Parser** | Unstructured.io | Format coverage, metadata extraction | LlamaParse (cost), custom (effort) |

### 3.2 Singapore SMB Cost Analysis

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                     MONTHLY COST PROJECTION (1000 conversations/month)              │
└─────────────────────────────────────────────────────────────────────────────────────┘

INFRASTRUCTURE (Self-hosted on DigitalOcean SGP1)
├── API Server (2 vCPU, 4GB RAM)              SGD 35/month
├── Redis (1GB managed)                        SGD 20/month
├── PostgreSQL (1GB managed)                   SGD 20/month
├── Qdrant (2 vCPU, 4GB, self-hosted)          SGD 35/month
└── Total Infrastructure                       SGD 110/month

AI/API COSTS (Per 1000 conversations, ~15 turns avg)
├── Embeddings (text-embedding-3-small)
│   └── ~500K tokens × $0.02/1M               SGD 0.02
├── LLM - GPT-4o-mini (90% of queries)
│   └── ~1.5M input + 300K output × pricing   SGD 15
├── LLM - GPT-4o (10% complex/escalation)
│   └── ~100K input + 20K output × pricing    SGD 8
└── Total AI Costs                             SGD 25/month

TOTAL ESTIMATED MONTHLY COST                   SGD 135/month
Cost per conversation                          SGD 0.135

Comparison: Human agent cost ~SGD 3-5/conversation
Savings: 95%+ on routine enquiries
```

---

## Phase 4: Implementation Plan

### 4.1 Project Structure

```
singapore-smb-support-agent/
├── 📁 frontend/                      # React application
│   ├── 📁 src/
│   │   ├── 📁 components/
│   │   │   ├── 📁 chat/              # Chat-specific components
│   │   │   │   ├── ChatWidget.tsx
│   │   │   │   ├── MessageBubble.tsx
│   │   │   │   ├── TypingIndicator.tsx
│   │   │   │   ├── InputArea.tsx
│   │   │   │   └── FeedbackButtons.tsx
│   │   │   └── 📁 ui/                # Shadcn components
│   │   ├── 📁 hooks/
│   │   │   ├── useChat.ts
│   │   │   ├── useWebSocket.ts
│   │   │   └── useLocalStorage.ts
│   │   ├── 📁 lib/
│   │   │   ├── api.ts
│   │   │   └── utils.ts
│   │   ├── 📁 types/
│   │   │   └── chat.ts
│   │   └── App.tsx
│   ├── tailwind.config.js
│   ├── package.json
│   └── tsconfig.json
│
├── 📁 backend/                       # FastAPI application
│   ├── 📁 app/
│   │   ├── 📁 api/
│   │   │   ├── 📁 routes/
│   │   │   │   ├── chat.py           # WebSocket & REST endpoints
│   │   │   │   ├── admin.py          # Knowledge base management
│   │   │   │   └── health.py
│   │   │   └── deps.py               # Dependencies
│   │   ├── 📁 core/
│   │   │   ├── config.py             # Settings management
│   │   │   ├── security.py           # Auth, rate limiting
│   │   │   └── logging.py
│   │   ├── 📁 agent/
│   │   │   ├── 📁 graph/
│   │   │   │   ├── nodes.py          # LangGraph nodes
│   │   │   │   ├── edges.py          # Conditional edges
│   │   │   │   └── state.py          # State definitions
│   │   │   ├── 📁 tools/
│   │   │   │   ├── knowledge_search.py
│   │   │   │   ├── product_lookup.py
│   │   │   │   ├── booking.py
│   │   │   │   ├── escalation.py
│   │   │   │   └── business_hours.py
│   │   │   ├── 📁 prompts/
│   │   │   │   ├── system.py
│   │   │   │   ├── classification.py
│   │   │   │   └── generation.py
│   │   │   └── agent.py              # Main agent orchestrator
│   │   ├── 📁 rag/
│   │   │   ├── 📁 ingestion/
│   │   │   │   ├── loaders.py
│   │   │   │   ├── chunkers.py
│   │   │   │   └── embedders.py
│   │   │   ├── 📁 retrieval/
│   │   │   │   ├── hybrid_search.py
│   │   │   │   ├── reranker.py
│   │   │   │   └── compressor.py
│   │   │   └── pipeline.py           # RAG orchestration
│   │   ├── 📁 memory/
│   │   │   ├── short_term.py         # Redis operations
│   │   │   ├── long_term.py          # PostgreSQL operations
│   │   │   ├── semantic.py           # Qdrant conversation memory
│   │   │   └── summarizer.py         # Conversation summarization
│   │   ├── 📁 models/
│   │   │   ├── schemas.py            # Pydantic models
│   │   │   ├── database.py           # SQLAlchemy models
│   │   │   └── enums.py
│   │   └── main.py
│   ├── 📁 tests/
│   │   ├── 📁 unit/
│   │   ├── 📁 integration/
│   │   └── 📁 evaluation/            # RAGAs tests
│   ├── 📁 scripts/
│   │   ├── ingest_documents.py
│   │   ├── evaluate_rag.py
│   │   └── seed_data.py
│   ├── pyproject.toml
│   ├── Dockerfile
│   └── docker-compose.yml
│
├── 📁 knowledge_base/                # Source documents
│   ├── 📁 products/
│   ├── 📁 policies/
│   ├── 📁 faqs/
│   └── 📁 general/
│
├── 📁 infrastructure/
│   ├── docker-compose.yml            # Local development
│   ├── docker-compose.prod.yml       # Production
│   └── 📁 k8s/                       # Kubernetes manifests (optional)
│
├── 📁 docs/
│   ├── ARCHITECTURE.md
│   ├── API.md
│   ├── DEPLOYMENT.md
│   └── RUNBOOK.md
│
└── README.md
```

### 4.2 Implementation Phases & Checklists

---

#### **PHASE 1: Foundation Setup (Week 1)**

**Objective**: Establish project infrastructure and development environment

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ PHASE 1 CHECKLIST                                                                   │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│ □ 1.1 Project Initialization                                                        │
│   □ Create monorepo structure                                                       │
│   □ Initialize frontend with Vite + React + TypeScript                              │
│   □ Initialize backend with Poetry + FastAPI                                        │
│   □ Configure shared .env handling                                                  │
│   □ Set up pre-commit hooks (black, ruff, prettier)                                 │
│                                                                                     │
│ □ 1.2 Infrastructure Setup                                                          │
│   □ Create docker-compose.yml with all services                                     │
│   □ Configure PostgreSQL with initial schema                                        │
│   □ Configure Redis                                                                 │
│   □ Deploy Qdrant with collection schemas                                           │
│   □ Verify all services communicate correctly                                       │
│                                                                                     │
│ □ 1.3 Database Schema Implementation                                                │
│   □ Create SQLAlchemy models for customers, conversations, events                   │
│   □ Create Pydantic schemas for all data models                                     │
│   □ Implement Alembic migrations                                                    │
│   □ Seed test data                                                                  │
│                                                                                     │
│ □ 1.4 Core API Structure                                                            │
│   □ Implement FastAPI app factory pattern                                           │
│   □ Set up dependency injection                                                     │
│   □ Configure CORS for frontend                                                     │
│   □ Implement health check endpoints                                                │
│   □ Set up logging with correlation IDs                                             │
│                                                                                     │
│ VALIDATION CHECKPOINT:                                                              │
│ ✓ docker-compose up starts all services                                             │
│ ✓ API returns 200 on /health                                                        │
│ ✓ Can connect to PostgreSQL, Redis, Qdrant                                          │
│ ✓ Database migrations run successfully                                              │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

**Key Deliverables**:
- Working Docker environment
- Database schemas and migrations
- Basic API skeleton

---

#### **PHASE 2: RAG Pipeline (Week 2)**

**Objective**: Build complete document ingestion and retrieval pipeline

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ PHASE 2 CHECKLIST                                                                   │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│ □ 2.1 Document Ingestion Pipeline                                                   │
│   □ Implement document loaders (PDF, DOCX, Markdown, CSV)                           │
│   □ Integrate Unstructured.io for complex parsing                                   │
│   □ Implement text cleaning (headers, footers, noise removal)                       │
│   □ Build metadata extraction (auto-categorization)                                 │
│   □ Create CLI for bulk document ingestion                                          │
│                                                                                     │
│ □ 2.2 Chunking Strategy Implementation                                              │
│   □ Implement semantic chunker with sentence-transformers                           │
│   □ Configure chunk sizes (512 tokens, 50 overlap)                                  │
│   □ Special handling for FAQ documents (preserve Q&A pairs)                         │
│   □ Preserve table structure in chunks                                              │
│   □ Add chunk-level metadata (position, doc summary)                                │
│                                                                                     │
│ □ 2.3 Embedding & Storage                                                           │
│   □ Implement OpenAI embedding wrapper with retry logic                             │
│   □ Batch embedding generation                                                      │
│   □ Create Qdrant collections with proper schemas                                   │
│   □ Implement upsert logic for document updates                                     │
│   □ Add BM25 index for sparse retrieval                                             │
│                                                                                     │
│ □ 2.4 Retrieval Pipeline                                                            │
│   □ Implement query transformation (rewrite + expansion)                            │
│   □ Build hybrid search (BM25 + vector)                                             │
│   □ Implement RRF fusion                                                            │
│   □ Integrate cross-encoder reranker                                                │
│   □ Implement context compression                                                   │
│   □ Add metadata filtering support                                                  │
│                                                                                     │
│ □ 2.5 Testing & Evaluation                                                          │
│   □ Create test document set                                                        │
│   □ Implement RAGAs evaluation pipeline                                             │
│   □ Measure retrieval metrics (precision, recall, NDCG)                             │
│   □ Tune hyperparameters based on results                                           │
│                                                                                     │
│ VALIDATION CHECKPOINT:                                                              │
│ ✓ Can ingest 50+ documents of various formats                                       │
│ ✓ Retrieval returns relevant chunks for test queries                                │
│ ✓ Context Precision@5 > 0.7 on test set                                             │
│ ✓ Reranker improves precision by measurable margin                                  │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

**Key Deliverables**:
- Document ingestion CLI
- Working hybrid search
- Evaluated retrieval pipeline

---

#### **PHASE 3: Agent Core (Week 3)**

**Objective**: Implement LangGraph agent with tools and memory

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ PHASE 3 CHECKLIST                                                                   │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│ □ 3.1 LangGraph State Machine                                                       │
│   □ Define ConversationState schema                                                 │
│   □ Implement RECEIVE_MESSAGE node                                                  │
│   □ Implement CLASSIFY_INTENT node (with few-shot examples)                         │
│   □ Implement RETRIEVE node (calls RAG pipeline)                                    │
│   □ Implement GENERATE_RESPONSE node                                                │
│   □ Implement VALIDATE_OUTPUT node                                                  │
│   □ Implement UPDATE_MEMORY node                                                    │
│   □ Wire up conditional edges                                                       │
│   □ Compile and test graph execution                                                │
│                                                                                     │
│ □ 3.2 Tool Implementation                                                           │
│   □ knowledge_search: RAG retrieval tool                                            │
│   □ get_product_details: Product database lookup                                    │
│   □ check_business_hours: Operating hours with timezone                             │
│   □ create_support_ticket: Human escalation                                         │
│   □ get_pricing: Price calculation tool                                             │
│   □ Add tool descriptions for LLM                                                   │
│                                                                                     │
│ □ 3.3 Prompt Engineering                                                            │
│   □ System prompt with Singapore business persona                                   │
│   □ Intent classification prompt with examples                                      │
│   □ Response generation prompt with tone guidelines                                 │
│   □ Multi-language handling instructions                                            │
│   □ Singlish tolerance guidelines                                                   │
│                                                                                     │
│ □ 3.4 Memory Integration                                                            │
│   □ Implement short-term memory (Redis)                                             │
│   │   □ Session storage with TTL                                                    │
│   │   □ Message buffer management                                                   │
│   │   □ Rolling summarization trigger                                               │
│   □ Implement long-term memory (PostgreSQL)                                         │
│   │   □ Customer profile CRUD                                                       │
│   │   □ Conversation persistence                                                    │
│   │   □ Interaction event logging                                                   │
│   □ Implement semantic memory (Qdrant)                                              │
│   │   □ Conversation embedding storage                                              │
│   │   □ Similar conversation retrieval                                              │
│   □ Wire memory into agent state                                                    │
│                                                                                     │
│ □ 3.5 Response Validation                                                           │
│   □ Implement hallucination check (claim verification)                              │
│   □ Implement PDPA compliance filter                                                │
│   □ Add confidence scoring                                                          │
│   □ Escalation trigger logic                                                        │
│                                                                                     │
│ VALIDATION CHECKPOINT:                                                              │
│ ✓ Agent handles 10 test scenarios correctly                                         │
│ ✓ Memory persists across simulated sessions                                         │
│ ✓ Tools execute successfully                                                        │
│ ✓ Response quality meets business requirements                                      │
│ ✓ Faithfulness score > 0.85 on test set                                             │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

**Key Deliverables**:
- Complete LangGraph agent
- All business tools
- Working memory system

---

#### **PHASE 4: API & Streaming (Week 4)**

**Objective**: Production-ready API with WebSocket streaming

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ PHASE 4 CHECKLIST                                                                   │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│ □ 4.1 WebSocket Implementation                                                      │
│   □ Create /ws/chat/{session_id} endpoint                                           │
│   □ Implement connection manager (multi-client)                                     │
│   □ Add authentication middleware                                                   │
│   □ Implement heartbeat/ping-pong                                                   │
│   □ Handle reconnection gracefully                                                  │
│                                                                                     │
│ □ 4.2 Streaming Response                                                            │
│   □ Integrate LangChain streaming callbacks                                         │
│   □ Stream tokens as they generate                                                  │
│   □ Send structured events (thinking, sources, complete)                            │
│   □ Handle stream interruption                                                      │
│                                                                                     │
│ □ 4.3 REST Fallback Endpoints                                                       │
│   □ POST /api/chat (non-streaming)                                                  │
│   □ GET /api/conversations/{id}                                                     │
│   □ POST /api/feedback                                                              │
│   □ Admin endpoints for knowledge base                                              │
│                                                                                     │
│ □ 4.4 Rate Limiting & Security                                                      │
│   □ Implement token bucket rate limiter                                             │
│   □ Add request validation                                                          │
│   □ Implement session authentication                                                │
│   □ Add input sanitization                                                          │
│   □ CORS configuration                                                              │
│                                                                                     │
│ □ 4.5 Error Handling                                                                │
│   □ Graceful LLM timeout handling                                                   │
│   □ Fallback responses for failures                                                 │
│   □ Structured error responses                                                      │
│   □ Logging for debugging                                                           │
│                                                                                     │
│ VALIDATION CHECKPOINT:                                                              │
│ ✓ WebSocket maintains stable connection                                             │
│ ✓ Tokens stream in real-time                                                        │
│ ✓ Rate limiting prevents abuse                                                      │
│ ✓ Errors return helpful messages                                                    │
│ ✓ Load test: 50 concurrent connections                                              │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

**Key Deliverables**:
- Production WebSocket API
- Streaming infrastructure
- Security layer

---

#### **PHASE 5: React Frontend (Week 5)**

**Objective**: Polished, accessible chat interface

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ PHASE 5 CHECKLIST                                                                   │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│ □ 5.1 Chat Widget Core                                                              │
│   □ ChatWidget container component                                                  │
│   □ MessageList with virtualization                                                 │
│   □ MessageBubble (user/assistant variants)                                         │
│   □ InputArea with send button                                                      │
│   □ TypingIndicator animation                                                       │
│                                                                                     │
│ □ 5.2 WebSocket Integration                                                         │
│   □ useChat hook for state management                                               │
│   □ useWebSocket hook with reconnection                                             │
│   □ Stream token handling                                                           │
│   □ Connection status indicator                                                     │
│                                                                                     │
│ □ 5.3 UX Enhancements                                                               │
│   □ Markdown rendering in responses                                                 │
│   □ Source citations (collapsible)                                                  │
│   □ Quick action buttons                                                            │
│   □ Feedback thumbs up/down                                                         │
│   □ Conversation history (local storage)                                            │
│   □ "New conversation" action                                                       │
│                                                                                     │
│ □ 5.4 Accessibility (WCAG AAA)                                                      │
│   □ Full keyboard navigation                                                        │
│   □ Screen reader announcements                                                     │
│   □ Focus management                                                                │
│   □ High contrast mode                                                              │
│   □ Reduced motion support                                                          │
│   □ ARIA labels                                                                     │
│                                                                                     │
│ □ 5.5 Visual Design                                                                 │
│   □ Implement design system with CSS variables                                      │
│   □ Light/dark theme support                                                        │
│   □ Responsive layout (mobile-first)                                                │
│   □ Micro-animations (Framer Motion)                                                │
│   □ Loading states                                                                  │
│                                                                                     │
│ □ 5.6 Embed Widget                                                                  │
│   □ Standalone widget bundle                                                        │
│   □ Embed script for third-party sites                                              │
│   □ Configuration options (theme, position)                                         │
│                                                                                     │
│ VALIDATION CHECKPOINT:                                                              │
│ ✓ Chat flows smoothly with streaming                                                │
│ ✓ Passes axe accessibility audit                                                    │
│ ✓ Works on mobile (iOS/Android browsers)                                            │
│ ✓ Lighthouse performance > 90                                                       │
│ ✓ Widget embeds correctly on test page                                              │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

**Key Deliverables**:
- Complete chat widget
- Accessible interface
- Embeddable widget

---

#### **PHASE 6: Integration & Evaluation (Week 6)**

**Objective**: End-to-end testing and quality assurance

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ PHASE 6 CHECKLIST                                                                   │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│ □ 6.1 End-to-End Integration                                                        │
│   □ Connect frontend to backend                                                     │
│   □ Test complete conversation flows                                                │
│   □ Verify memory persistence                                                       │
│   □ Test escalation paths                                                           │
│   □ Multi-session testing                                                           │
│                                                                                     │
│ □ 6.2 RAG Evaluation (RAGAs)                                                        │
│   □ Create evaluation dataset (50+ Q&A pairs)                                       │
│   □ Measure Context Precision                                                       │
│   □ Measure Context Recall                                                          │
│   □ Measure Faithfulness                                                            │
│   □ Measure Answer Relevancy                                                        │
│   □ Document baseline metrics                                                       │
│                                                                                     │
│ □ 6.3 Agent Evaluation                                                              │
│   □ Intent classification accuracy                                                  │
│   □ Tool selection appropriateness                                                  │
│   □ Response tone consistency                                                       │
│   □ Multi-turn coherence                                                            │
│   □ Language handling tests                                                         │
│                                                                                     │
│ □ 6.4 Load Testing                                                                  │
│   □ Concurrent user simulation (50 users)                                           │
│   □ Measure response latency (p50, p95, p99)                                        │
│   □ Identify bottlenecks                                                            │
│   □ Stress test memory systems                                                      │
│                                                                                     │
│ □ 6.5 Security Testing                                                              │
│   □ Prompt injection testing                                                        │
│   □ Input validation testing                                                        │
│   □ Rate limit testing                                                              │
│   □ PDPA compliance verification                                                    │
│                                                                                     │
│ VALIDATION CHECKPOINT:                                                              │
│ ✓ Faithfulness > 0.85                                                               │
│ ✓ Answer Relevancy > 0.80                                                           │
│ ✓ P95 latency < 3 seconds                                                           │
│ ✓ No critical security issues                                                       │
│ ✓ All integration tests pass                                                        │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

**Key Deliverables**:
- Evaluation reports
- Performance benchmarks
- Security audit

---

#### **PHASE 7: Production Deployment (Week 7)**

**Objective**: Deploy to production with monitoring

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ PHASE 7 CHECKLIST                                                                   │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│ □ 7.1 Production Infrastructure                                                     │
│   □ Set up production server (DigitalOcean SGP1)                                    │
│   □ Configure SSL/TLS                                                               │
│   □ Set up managed PostgreSQL                                                       │
│   □ Set up managed Redis                                                            │
│   □ Deploy Qdrant with persistence                                                  │
│                                                                                     │
│ □ 7.2 Deployment Pipeline                                                           │
│   □ Dockerize frontend and backend                                                  │
│   □ Create CI/CD with GitHub Actions                                                │
│   □ Implement blue-green deployment                                                 │
│   □ Database migration in pipeline                                                  │
│   □ Secrets management                                                              │
│                                                                                     │
│ □ 7.3 Monitoring & Observability                                                    │
│   □ Set up application logging (structured JSON)                                    │
│   □ Implement distributed tracing                                                   │
│   □ Set up metrics collection (Prometheus)                                          │
│   □ Create dashboards (Grafana)                                                     │
│   □ Configure alerts                                                                │
│                                                                                     │
│ □ 7.4 LLM Observability                                                             │
│   □ Track token usage per conversation                                              │
│   □ Log retrieval quality metrics                                                   │
│   □ Monitor response quality scores                                                 │
│   □ Track escalation rates                                                          │
│                                                                                     │
│ □ 7.5 Documentation                                                                 │
│   □ Deployment runbook                                                              │
│   □ Troubleshooting guide                                                           │
│   □ Knowledge base update procedures                                                │
│   □ API documentation                                                               │
│                                                                                     │
│ VALIDATION CHECKPOINT:                                                              │
│ ✓ Production deployment successful                                                  │
│ ✓ SSL configured correctly                                                          │
│ ✓ Monitoring dashboards operational                                                 │
│ ✓ Alerts trigger correctly                                                          │
│ ✓ Runbook tested by second person                                                   │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

**Key Deliverables**:
- Production deployment
- Monitoring stack
- Complete documentation

---

## Phase 5: Design Validation

### 5.1 Architecture Validation Matrix

| Requirement | Design Solution | Validation Status |
|-------------|-----------------|-------------------|
| **Context-aware conversations** | LangGraph state machine + hierarchical memory | ✅ Validated |
| **Short-term memory** | Redis session buffer with rolling summarization | ✅ Validated |
| **Long-term memory** | PostgreSQL profiles + Qdrant semantic memory | ✅ Validated |
| **RAG integration** | Hybrid search + cross-encoder reranking | ✅ Validated |
| **Singapore SMB context** | Multi-language, PDPA compliance, local timezone | ✅ Validated |
| **React frontend** | Shadcn/UI components + WebSocket streaming | ✅ Validated |
| **LangChain 1.0** | LangGraph for agent, LCEL for chains | ✅ Validated |
| **Pydantic AI** | Pydantic v2 schemas for all data models | ✅ Validated |
| **Production-ready** | Docker, monitoring, security, documentation | ✅ Validated |

### 5.2 Risk Assessment & Mitigation

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| **LLM latency spikes** | Medium | High | Streaming responses, fallback to faster model |
| **RAG retrieval misses** | Medium | Medium | Hybrid search, reranking, human escalation path |
| **Memory overflow** | Low | High | Rolling summarization, TTL on sessions |
| **Cost overrun** | Medium | Medium | Token tracking, model routing (4o-mini default) |
| **PDPA violation** | Low | Critical | Consent management, data retention policies |
| **Singlish misunderstanding** | Medium | Low | Examples in prompts, graceful clarification |

### 5.3 Scalability Considerations

```
SCALING PATH (As SMB grows)
════════════════════════════

STAGE 1: Single Instance (Current Design)
├── 1000 conversations/month
├── Single API server
├── Single Qdrant instance
└── Estimated cost: SGD 135/month

STAGE 2: Horizontal API Scaling
├── 5000 conversations/month
├── Load balancer + 2 API instances
├── Redis cluster for session sharing
└── Estimated cost: SGD 250/month

STAGE 3: Enterprise Scaling
├── 20000+ conversations/month
├── Kubernetes deployment
├── Qdrant cluster (3 nodes)
├── Read replicas for PostgreSQL
└── Estimated cost: SGD 600/month
```

---

## Phase 6: Confirmation Request

### Summary of Proposed System

| Aspect | Specification |
|--------|---------------|
| **Architecture** | Microservices: React Frontend + FastAPI Backend + LangGraph Agent |
| **RAG Strategy** | Hybrid search (BM25 + Vector) → Cross-encoder rerank → Context compression |
| **Memory Model** | 3-tier: Working (context) → Short-term (Redis) → Long-term (PostgreSQL + Qdrant) |
| **Agent Pattern** | LangGraph state machine with ReAct-style tool use |
| **LLM Strategy** | GPT-4o-mini (90%), GPT-4o (complex queries) |
| **Vector Store** | Qdrant (self-hosted) |
| **Estimated Timeline** | 7 weeks |
| **Estimated Monthly Cost** | SGD 135 (1000 conversations) |

---

## Awaiting Your Validation

Before I proceed to implementation, please confirm:

1. **✅ Architecture Approval**: Does the proposed architecture meet your requirements?

2. **✅ Technology Stack**: Are you aligned with the selected technologies (LangGraph, Qdrant, GPT-4o-mini)?

3. **✅ Memory Strategy**: Is the 3-tier memory hierarchy appropriate for your use case?

4. **✅ Singapore Context**: Are the PDPA, multi-language, and Singlish considerations sufficient?

5. **✅ Implementation Timeline**: Is the 7-week phased approach acceptable?

6. **⚠️ Any Modifications**: Should any aspects be adjusted before implementation begins?

---

**Upon your approval, I will proceed to Phase 1 implementation with complete code, starting with the infrastructure setup and Pydantic schemas.**